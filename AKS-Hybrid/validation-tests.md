---
title: Validation tests in AKS hybrid
description: Learn how to validate your environment and configuration prior to installing AKS hybrid.
author: sethmanheim
ms.topic: troubleshooting
ms.date: 01/26/2023
ms.author: sethm 
ms.lastreviewed: 01/26/2023
ms.reviewer: waltero

---

# AKS hybrid pre-install validation tests

The following table lists the tests that are executed when you run the [Set-AksHciConfig](reference/ps/set-akshciconfig.md) and [Set-AksHciRegistration](reference/ps/set-akshciregistration.md) PowerShell cmdlets. The tests help to ensure that when you run the actual installation with [Install-AksHci](reference/ps/install-akshci.md), the installation process avoids many common environment and configuration issues. For a better understanding of the terms used in the tests, see the [AKS hybrid concepts article](kubernetes-concepts.md).

| Test Name                                               | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | Troubleshooting Resources                                                                                                                                                                                                                       |
|---------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| MOC Host Internet Connectivity                          | The test validates that the machine hosting MOC has internet connectivity to key Microsoft endpoints.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |   Ensure that there is connectivity from the physical hosts to the internet   Troubleshooting network issues in Azure Stack HCI.   Blog post on troubleshooting network issues in Windows Server.   Firewall requirements for Azure Stack HCI.  |
| MOC Host Limits                                         | The test validates that the machine hosting MOC has the minimum resources needed. Refer to the published hardware requirements                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |   Ensure that the minimum requirements are met, see them here: AKS Hybrid system requirements.                                                                                                                                                  |
| MOC Host Remoting                                       | The test validates that PowerShell remoting is enabled and working from the MOC hosting machine to other physical hostsnodes in the cluster                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |   Troubleshoot CredSSP issues   Troubleshoot PowerShell Remoting issues                                                                                                                                                                         |
| MOC Network Configuration                               | Test validate that MOC Network Configuration is correct. It verifies that:     Virtual Switch exists   The CloudServiceIP can be used to provide a static IP address to be assigned to the MOC CloudAgent service. This value  should be provided using the standard IPv4 format. (Example: 192.168.1.2). The cloudServiceIP address should also be carved out of one of the ClusterAndClient networks in the underlying Failover cluster.        You can run Get-ClusterNetwork command in an elevated powershell mode to find the network role.  You may want to specify this to ensure that anything important on the network is always accessible because the IP address will not change.   Should be able to create and start Failover Cluster resource.   Cloud service IP should not overlap with VIP pool, or k8snodepool IP addresses provided during VNET configuration.  |   Ensure that the IP address of the CloudServiceIP meets the requirements in the description.      AKS hybrid Network Concepts   AKS hybrid Network troubleshooting   Troubleshoot network issues in Azure Stack HCI                            |
| MOC SDN Configuration                                   | Validate that the SDN configuration is correct, and the Network Controller is available, it checks:     Network Controller FQDN Or IP address information is reachable.   Network Controller Load Balancer Subnet Resource Reference is provided.   Network Controller L netRef is provided.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |   If you are providing SDN parameters please ensure that SDN is available in the system   AKS hybrid Network Concepts   Troubleshooting SDN   Checklist for troubleshooting SDN                                                                 |
| MOC directories                                         | Validate MOC directories. It checks for:     Valid dir names   Config directory cannot contain the Working directory.   Check if the working directory is in the Cluster Shared Volume.   Check that the directories are not local.   check to ensure working directory is not System Drive or Root.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |   Ensure the User account has access to the directories provided.   Verified that no previous install of MOC exists   Verify that Config directory cannot contain the Working directory                                                         |
| Failover Cluster Health                                 | Validate Failover Cluster Health. It checks that cluster nodes and cluster network are available.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |   Ensure that there is a Failover setup, review Failover Clustering   Run an HCI cluster validation test   Troubleshooting the failover cluster                                                                                                 |
| Failover Cluster HCI Registration                       | Validate Failover Cluster HCI Registration. It checks for the presence of a failover cluster.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |   Run an HCI cluster validation test   Troubleshooting the failover cluster                                                                                                                                                                     |
| AKS Management Cluster Configuration                    | Validate AKS Management cluster configuration and corresponding host machine configuration to make sure host is ready to install it successfully. Verifies:     AKS Management Image is present   AKS hybrid related binaries are present in all nodes   Necessary AzureStackHCI cloud roles are added   Verifies AzureStackHCI cloud location   Verifies AzureStackHCI cloud storage container   Verifies permissions to create Azure Resource   Verifies AzureStackHCI network and loadbalancer type   Verifies Kube-Vip configuration   Verifies Vip-pool IPs   Verifies K8s node pool IPs                                                                                                                                                                                                                                                                                       |   Review the Active Directory requirements   AKS hybrid Network troubleshooting   Ensure user has the needed permissions   Ensure that IP formatting is correct                                                                                 |
| AKS Management Cluster Configuration Proxy connectivity | Validates that the configuration allows internet connectivity to Microsoft end-points through a Proxy server or without.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |   Ensure the host has internet connectivity   Follow the Proxy Settings Guide                                                                                                                                                                   |