---
title: Validation tests in AKS hybrid
description: Learn how to validate your environment and configuration prior to installing AKS hybrid.
author: sethmanheim
ms.topic: troubleshooting
ms.date: 01/26/2023
ms.author: sethm 
ms.lastreviewed: 01/26/2023
ms.reviewer: waltero

---

# AKS hybrid pre-install validation tests

The following table lists the tests that are executed when you run the [Set-AksHciConfig](reference/ps/set-akshciconfig.md) and [Set-AksHciRegistration](reference/ps/set-akshciregistration.md) PowerShell cmdlets. The tests help to ensure that when you run the actual installation with [Install-AksHci](reference/ps/install-akshci.md), the installation process avoids many common environment and configuration issues. For a better understanding of the terms used in the tests, see the [AKS hybrid concepts article](kubernetes-concepts.md).

| Test Name                                                                                                                                              | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | Troubleshooting Resources                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|--------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [MOC](concepts-node-networking.md#microsoft-on-pre mises-cloud-service) host internet connectivity | The test validates that the machine hosting MOC has internet connectivity to key Microsoft endpoints.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | <br />

- Ensure that there is connectivity from the physical hosts to the internet
- [Troubleshooting network issues in Azure Stack HCI](https://techcommunity.microsoft.com/t5/networking-blog/introducing-network-hud-for-azure-stack-hci/ba-p/3676097)
- [Blog post on troubleshooting network issues](https://techcommunity.microsoft.com/t5/itops-talk-blog/how-to-troubleshoot-windows-server-network-connectivity-issues/ba-p/1500934) in Windows     Server.
- [Firewall requirements for Azure Stack HCI](/azure-stack/hci/concepts/firewall-requirements). |
| MOC host limits                                                                                                                                        | The test validates that the machine hosting MOC has the minimum resources needed. See the published [hardware requirements](system-requirements.md?tabs=allow-table#hardware-requirements).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | Ensure that the minimum requirements are met: [AKS hybrid system requirements](system-requirements.md?tabs=allow-table#compute-requirements).                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| MOC host remoting                                                                                                                                      | The test validates that PowerShell remoting is enabled and working from the MOC hosting machine to other physical hosts in the cluster. | - [Troubleshoot CredSSP issues](/azure-stack/hci/manage/troubleshoot-credssp)  -   [Troubleshoot PowerShell remoting issues](/powershell/module/microsoft.powershell.core/about/about_remote_troubleshooting?view=powershell-7.3)                                                                                                                                                                                                                                                                                                                                               |
| MOC network configuration                                                                                                                              | Test validates that MOC network configuration is correct. It verifies that:<br /> 
- Virtual switch exists. <br />
- The CloudServiceIP can be used to provide a static IP address to be assigned to the MOC CloudAgent service. This value should be provided using the standard IPv4 format. (Example: 192.168.1.2). The cloudServiceIP address should also be carved out of one of the ClusterAndClient networks in the underlying failover cluster. You can run `Get-ClusterNetwork` in an elevated PowerShell session to find the network role. You may want to specify this to ensure that anything important on the network is always accessible because the IP address will not change.
- Should be able to create and start failover cluster resource.
- Cloud service IP should not overlap with VIP pool, or k8snodepool IP addresses provided during VNET configuration. | - Ensure that the IP address of the CloudServiceIP meets the requirements in the description.
- [AKS hybrid network concepts](concepts-node-networking.md)
- [AKS hybrid network troubleshooting](known-issues-networking.md)
- [Troubleshoot network issues in Azure Stack HCI](https://azurehybridevents.z22.web.core.windows.net/content/9.AzStackHCI-TroubleShooting.pdf)                                                                                                                        |
| MOC SDN configuration                                                                                                                                  | Validates that the SDN configuration is correct, and the Network Controller is available. It checks the following:
- Network Controller FQDN or IP address information is reachable.
- Network Controller load balancer subnet resource reference is provided.
- Network Controller L-netRef is provided.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | - If you are providing SDN     parameters, ensure that SDN is available in the system.
- [AKS hybrid network concepts](concepts-node-networking.md)
- [Troubleshooting SDN](/windows-server/networking/sdn/troubleshoot/troubleshoot-software-defined-networking)
- [Checklist for troubleshooting SDN](/troubleshoot/windows-server/software-defined-networking/troubleshoot-sdn-guidance)                                                              |
| MOC directories                                                                                                                                        | Validates MOC directories. It checks for:  
- Valid directory names.
- Config directory cannot contain the working directory.
- Checks if the working directory is in the cluster shared volume.
- Checks that the directories are not local.
- Checks to ensure working directory is not a system drive or root.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | -   Ensure the user account has access to the directories     provided.
- Verify that no previous install of MOC exists.
- Verify that the config directory cannot contain the working     directory.                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Failover cluster health                                                                                                                                | Validates failover cluster Health. Checks that cluster nodes and cluster network are available.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | - Ensure that there is a failover setup. See [Failover clustering](/windows-server/failover-clustering/failover-clustering-overview).
- [Run an HCI cluster validation test](/azure-stack/hci/manage/validate-qos#run-a-cluster-validation-test)
- [Troubleshooting the failover cluster](/windows-server/failover-clustering/troubleshooting-using-wer-reports)                                                                                                                                                   |
| Failover cluster HCI registration                                                                                                                      | Validates failover cluster HCI registration. Checks for the presence of a failover cluster.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | - [Run an HCI cluster validation test](/azure-stack/hci/manage/validate-qos#run-a-cluster-validation-test)
- [Troubleshooting the failover cluster](/windows-server/failover-clustering/troubleshooting-using-wer-reports)                                                                                                                                                                                                                                                                                                                                                    |
| AKS management cluster configuration                                                                                                                   | Validates the AKS management cluster configuration and corresponding host machine configuration to make sure the host is ready to install it successfully. Verifies:
- AKS management image is present.
- AKS hybrid-related binaries are present in all nodes.
- Necessary Azure Stack HCI cloud roles are added.
- Verifies Azure Stack HCI cloud location.
- Verifies Azure Stack HCI cloud storage container.
- Verifies permissions to create Azure Resource
- Verifies Azure Stack HCI network and load balancer type.
- Verifies Kube-Vip configuration.
- Verifies Vip-pool IPs.
- Verifies K8s node pool IPs.                                                                                                                                                                                                                                                                                                                                                                                           | -   - Review the [Active Directory requirements](system-requirements.md?tabs=allow-table#active-directory-requirements).
- [AKS hybrid network troubleshooting](concepts-node-networking.md)
- Ensure the user has the needed permissions.
- Ensure that IP formatting is correct.                                                                                                                                                                                                                                          |
| AKS Management Cluster Configuration Proxy connectivity                                                                                                | Validates that the configuration allows internet connectivity to Microsoft endpoints with or without a proxy server.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | - Ensure the host     has internet connectivity.
- Follow the [proxy settings guide](set-proxy-settings.md).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
